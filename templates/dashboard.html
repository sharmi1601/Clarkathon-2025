<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - FitTrack AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <span class="logo-text">FitTrack AI</span>
            </div>
            <ul class="nav-menu">
                <li><a href="/" class="nav-link">Home</a></li>
                <li><a href="/dashboard" class="nav-link active">Dashboard</a></li>
                <li><a href="/profile" class="nav-link">Profile</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <!-- Hero Section -->
        <header class="hero">
            <div class="hero-content">
                <div class="hero-text">
                    <h1 class="hero-title">Your Progress Dashboard</h1>
                    <p class="hero-subtitle">Track your achievements and monitor your fitness journey</p>
                </div>
                <button id="clear-data-btn" class="btn btn-danger">Clear All Data</button>
            </div>
        </header>
        
        <!-- Stats Summary -->
        <div class="stats-summary">
            <div class="summary-card">
                <div class="summary-label">Total Workouts</div>
                <div class="summary-content">
                    <p class="summary-value">{{ total_workouts }}</p>
                    <span class="summary-trend">+12% this month</span>
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Total Exercises</div>
                <div class="summary-content">
                    <p class="summary-value">{{ total_exercises }}</p>
                    <span class="summary-trend">+8% this month</span>
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-label">This Week</div>
                <div class="summary-content">
                    <p class="summary-value">{{ weekly_workouts }}</p>
                    <span class="summary-trend">Keep it up</span>
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Streak Days</div>
                <div class="summary-content">
                    <p class="summary-value">{{ streak_days }}</p>
                    <span class="summary-trend">New record</span>
                </div>
            </div>
        </div>
        
        <!-- Charts Section -->
        <div class="charts-section">
            <div class="chart-container">
                <div class="chart-header">
                    <h2>Weekly Activity</h2>
                    <p>Your workout intensity over the past 7 days</p>
                </div>
                <canvas id="weeklyChart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-header">
                    <h2>Exercise Distribution</h2>
                    <p>Breakdown of exercises performed</p>
                </div>
                <canvas id="exerciseChart"></canvas>
            </div>
        </div>
        
        <!-- Recent Workouts -->
        <div class="recent-section">
            <div class="section-header">
                <h2>Recent Workouts</h2>
                <p>Your latest training sessions</p>
            </div>
            <div class="table-container">
                <table class="workout-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Exercise</th>
                            <th>Sets</th>
                            <th>Reps</th>
                            <th>Duration</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for workout in recent_workouts %}
                        <tr>
                            <td><span class="table-badge">{{ workout.date }}</span></td>
                            <td><strong>{{ workout.exercise }}</strong></td>
                            <td>{{ workout.sets }}</td>
                            <td>{{ workout.reps }}</td>
                            <td><span class="duration-badge">{{ workout.duration }}</span></td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 2rem;">
                                <p style="margin-top: 1rem; color: var(--text-secondary);">No workouts yet. Start your first session!</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script>
        // Chart.js configuration for black and white theme
        Chart.defaults.color = '#999999';
        Chart.defaults.borderColor = '#333333';
        Chart.defaults.font.family = 'Poppins';
        
        // Real data from backend
        const weeklyStatsFromDB = {{ weekly_stats | tojson }};
        const exerciseDistFromDB = {{ exercise_distribution | tojson }};
        
        // Process weekly stats
        const dayOrder = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
        const weeklyWorkoutCounts = dayOrder.map(day => {
            return weeklyStatsFromDB[day] ? weeklyStatsFromDB[day].workout_count : 0;
        });
        
        const weeklyData = {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Workout Sessions',
                data: weeklyWorkoutCounts,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(54, 162, 235, 0.8)',
                    'rgba(255, 206, 86, 0.8)',
                    'rgba(75, 192, 192, 0.8)',
                    'rgba(153, 102, 255, 0.8)',
                    'rgba(255, 159, 64, 0.8)',
                    'rgba(199, 199, 199, 0.8)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)',
                    'rgba(199, 199, 199, 1)'
                ],
                borderWidth: 2,
                borderRadius: 4,
            }]
        };
        
        // Process exercise distribution
        const exerciseLabels = [];
        const exerciseCounts = [];
        
        if (exerciseDistFromDB && Object.keys(exerciseDistFromDB).length > 0) {
            for (const [exercise, count] of Object.entries(exerciseDistFromDB)) {
                exerciseLabels.push(exercise.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase()));
                exerciseCounts.push(count);
            }
        } else {
            // Fallback to sample data if no workouts yet
            exerciseLabels.push('Squats', 'Push Ups', 'Hammer Curls');
            exerciseCounts.push(0, 0, 0);
        }
        
        const exerciseData = {
            labels: exerciseLabels,
            datasets: [{
                data: exerciseCounts,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(54, 162, 235, 0.8)',
                    'rgba(255, 206, 86, 0.8)',
                    'rgba(75, 192, 192, 0.8)',
                    'rgba(153, 102, 255, 0.8)',
                    'rgba(255, 159, 64, 0.8)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 2
            }]
        };
        
        // Clear data functionality
        document.addEventListener('DOMContentLoaded', () => {
            const clearDataBtn = document.getElementById('clear-data-btn');
            
            if (clearDataBtn) {
                clearDataBtn.addEventListener('click', () => {
                    if (confirm('Are you sure you want to delete ALL workout data? This action cannot be undone.')) {
                        fetch('/clear_all_data', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                alert('All workout data has been cleared successfully!');
                                location.reload(); // Refresh the page
                            } else {
                                alert('Failed to clear data: ' + (data.error || 'Unknown error'));
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('An error occurred while clearing data.');
                        });
                    }
                });
            }
        });
        
        // Initialize charts
        window.addEventListener('DOMContentLoaded', () => {
            const weeklyChart = new Chart(
                document.getElementById('weeklyChart'),
                {
                    type: 'bar',
                    data: weeklyData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                }
            );
            
            const exerciseChart = new Chart(
                document.getElementById('exerciseChart'),
                {
                    type: 'doughnut',
                    data: exerciseData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    font: {
                                        size: 12
                                    }
                                }
                            }
                        }
                    }
                }
            );
        });
    </script>
</body>
</html>
